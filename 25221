<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Library Management System</title>

<style>
body{margin:0;font-family:Segoe UI;background:#eef2f3}
.hero{background:url("https://images.unsplash.com/photo-1524995997946-a1c2e315a42f") center/cover;height:260px;display:flex;align-items:center;justify-content:center;color:#fff}
.hero h1{background:rgba(0,0,0,.65);padding:15px 35px;border-radius:12px}
.container{max-width:1300px;margin:-50px auto 30px;background:#fff;border-radius:12px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.2)}
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:15px;margin-bottom:25px}
.stat{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;padding:20px;border-radius:12px;text-align:center}
.section{background:#f9f9f9;padding:20px;border-radius:10px;margin-bottom:25px;box-shadow:0 5px 15px rgba(0,0,0,.1)}
.section h2{margin-bottom:10px}
input{padding:8px;margin:5px;width:200px}
button{padding:8px 14px;background:#667eea;color:#fff;border:none;border-radius:5px;cursor:pointer}
button:hover{background:#764ba2}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
th{background:#667eea;color:#fff}
.search{float:right;padding:6px}
.actions{margin-top:10px}
</style>
</head>

<body>

<div class="hero">
<h1>ðŸ“š Library Management System</h1>
</div>

<div class="container">

<!-- DASHBOARD -->
<div class="stats">
<div class="stat">Total Books<br><span id="totalBooks">0</span></div>
<div class="stat">Total Students<br><span id="totalStudents">0</span></div>
<div class="stat">Issued Books<br><span id="issuedCount">0</span></div>
<div class="stat">Returned Books<br><span id="returnedCount">0</span></div>
</div>

<!-- ADD BOOK -->
<div class="section">
<h2>Add Book</h2>
<input id="bookId" placeholder="Book ID">
<input id="bookName" placeholder="Book Name">
<input id="author" placeholder="Author">
<input id="quantity" type="number" placeholder="Quantity">
<button onclick="addBook()">Add</button>
</div>

<!-- BOOK RECORD -->
<div class="section">
<h2>Book Records <input class="search" placeholder="Search" onkeyup="searchTable(this,'booksTable')"></h2>
<table>
<thead><tr><th>ID</th><th>Name</th><th>Author</th><th>Qty</th></tr></thead>
<tbody id="booksTable"></tbody>
</table>
</div>

<!-- ADD STUDENT -->
<div class="section">
<h2>Add Student</h2>
<input id="studentId" placeholder="Student ID">
<input id="studentName" placeholder="Student Name">
<button onclick="addStudent()">Add</button>
</div>

<!-- STUDENT RECORD -->
<div class="section">
<h2>Student Records <input class="search" placeholder="Search" onkeyup="searchTable(this,'studentsTable')"></h2>
<table>
<thead><tr><th>ID</th><th>Name</th></tr></thead>
<tbody id="studentsTable"></tbody>
</table>
</div>

<!-- ISSUE BOOK -->
<div class="section">
<h2>Issue Book</h2>
<input id="issueBookId" placeholder="Book ID">
<input id="issueStudentId" placeholder="Student ID">
<button onclick="issueBook()">Issue</button>
</div>

<!-- ISSUED RECORD -->
<div class="section">
<h2>Issued Records</h2>
<table id="issuedTable">
<thead><tr><th>Book ID</th><th>Book</th><th>Student</th><th>Time</th></tr></thead>
<tbody></tbody>
</table>
<div class="actions">
<button onclick="printTable('issuedTable')">Print</button>
<button onclick="exportCSV('issuedTable')">Export CSV</button>
</div>
</div>

<!-- RETURN BOOK -->
<div class="section">
<h2>Return Book</h2>
<input id="returnBookId" placeholder="Book ID">
<button onclick="returnBook()">Return</button>
</div>

<!-- RETURN RECORD -->
<div class="section">
<h2>Returned Records</h2>
<table id="returnedTable">
<thead><tr><th>Book ID</th><th>Book</th><th>Student</th><th>Time</th></tr></thead>
<tbody></tbody>
</table>
<div class="actions">
<button onclick="printTable('returnedTable')">Print</button>
<button onclick="exportCSV('returnedTable')">Export CSV</button>
</div>
</div>

</div>

<script>
let books=JSON.parse(localStorage.getItem("books"))||{};
let students=JSON.parse(localStorage.getItem("students"))||{};
let issuedLog=JSON.parse(localStorage.getItem("issuedLog"))||[];
let returnedLog=JSON.parse(localStorage.getItem("returnedLog"))||{};
returnedLog=JSON.parse(localStorage.getItem("returnedLog"))||[];

function save(){
localStorage.setItem("books",JSON.stringify(books));
localStorage.setItem("students",JSON.stringify(students));
localStorage.setItem("issuedLog",JSON.stringify(issuedLog));
localStorage.setItem("returnedLog",JSON.stringify(returnedLog));
}

function clearInputs(...i){i.forEach(x=>document.getElementById(x).value="")}

function addBook(){
books[bookId.value]={name:bookName.value,author:author.value,quantity:+quantity.value};
save();showBooks();clearInputs("bookId","bookName","author","quantity");
}

function addStudent(){
students[studentId.value]=studentName.value;
save();showStudents();clearInputs("studentId","studentName");
}

function issueBook(){
let b=issueBookId.value,s=issueStudentId.value;
if(!books[b]||!students[s]||books[b].quantity<=0)return;
books[b].quantity--;
issuedLog.push({b,book:books[b].name,s,time:new Date().toLocaleString()});
save();showBooks();showIssued();updateStats();clearInputs("issueBookId","issueStudentId");
}

function returnBook(){
let b=returnBookId.value;
let i=issuedLog.findIndex(x=>x.b===b);
if(i<0)return;
returnedLog.push({...issuedLog[i],time:new Date().toLocaleString()});
issuedLog.splice(i,1);
books[b].quantity++;
save();showBooks();showIssued();showReturned();updateStats();clearInputs("returnBookId");
}

function showBooks(){
booksTable.innerHTML="";let t=0;
for(let i in books){t+=books[i].quantity;
booksTable.innerHTML+=`<tr><td>${i}</td><td>${books[i].name}</td><td>${books[i].author}</td><td>${books[i].quantity}</td></tr>`}
totalBooks.textContent=t;
}

function showStudents(){
studentsTable.innerHTML="";
for(let i in students){studentsTable.innerHTML+=`<tr><td>${i}</td><td>${students[i]}</td></tr>`}
totalStudents.textContent=Object.keys(students).length;
}

function showIssued(){
issuedTable.querySelector("tbody").innerHTML="";
issuedLog.forEach(x=>{
issuedTable.querySelector("tbody").innerHTML+=`<tr><td>${x.b}</td><td>${x.book}</td><td>${x.s}</td><td>${x.time}</td></tr>`});
}

function showReturned(){
returnedTable.querySelector("tbody").innerHTML="";
returnedLog.forEach(x=>{
returnedTable.querySelector("tbody").innerHTML+=`<tr><td>${x.b}</td><td>${x.book}</td><td>${x.s}</td><td>${x.time}</td></tr>`});
}

function updateStats(){
issuedCount.textContent=issuedLog.length;
returnedCount.textContent=returnedLog.length;
}

function searchTable(input,id){
let f=input.value.toLowerCase();
[...document.getElementById(id).getElementsByTagName("tr")].forEach(r=>{
r.style.display=r.innerText.toLowerCase().includes(f)?"":"none";
});
}

function printTable(id){
let w=window.open("");
w.document.write(document.getElementById(id).outerHTML);
w.print();
}

function exportCSV(id){
let rows=[...document.getElementById(id).rows].map(r=>[...r.cells].map(c=>c.innerText).join(",")).join("\n");
let a=document.createElement("a");
a.href="data:text/csv;charset=utf-8,"+rows;
a.download=id+".csv";a.click();
}

showBooks();showStudents();showIssued();showReturned();updateStats();
</script>

</body>
</html>
